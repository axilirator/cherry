### Введение
Одним из самых эффективных способов получения несанкционированного доступа к чему-либо является метод "грубой силы" (*bruteforce*), которому подвержены многие системы защиты. Область применения данного метода довольно широка: решение простых математических задач, вскрытие замков, обход сложных систем защиты и так далее. Данному виду атаки подвержены все технологии защиты беспроводных сетей. Основная проблема заключается в сложности перебора. Если при атаке на беспроводные сети по протоколу WPS достаточно перебрать лишь 11000 комбинаций, то при оффлайн-атаке на handshake алгоритмов WPA/WPA2 количество комбинаций гораздо больше. В добавок положение усугубляет скорость расчета одного PMK (главного ключа к сети), которая зависит только от вычислительных мощностей атакующего. Однако, не все так плохо. На практике чаще всего применяются rainbow tables и атака по словарю, что значительно ускоряет процесс перебора паролей. Сегодня существует множество доступных любому желающему инструментов атаки на WPA/WPA2: пакет aircrack-ng, pyrit, hashcat, некоторые из них позволяют задействовать даже графические ускорители. Авторы pyrit даже добавили возможность распределять нагрузку на несколько машин по сети, но работает это все с ошибками да и не так, как хотелось бы...

Большим шагом вперед можно считать применение знаменитого принципа "разделяй и властвуй". Любую сложную задачу можно разделить на несколько простых. Поэтому распределение нагрузки при атаке на беспроводные сети может серьезно пошатнуть безопасность протоколов WPA/WPA2. Cherry является свободным программным обеспечением, позволяющим объединять вычислительные мощности удаленных машин в единый кластер и равномерно распределять общую нагрузку с целью повышения скорости перебора.

По определению, кластер - это объединение нескольких однородных элементов, которое может рассматриваться как самостоятельная единица, обладающая определёнными свойствами. В данном случае в роли элементов кластера выступает некоторое количество удаленных машин (далее узлов), выполняющих непосредственно перебор паролей, и сервер, координирующий действия узлов. Данная архитектура не ограничивает количество узлов, в следствие чего не ограничена и суммарная скорость перебора.

### Основные принципы работы кластера
Главным элементом кластера является сервер, основной задачей которого является распределение нагрузки. Так же сервер выполняет следующие не менее важные задачи:

- Обработка подключений новых узлов и отключений уже подключенных. Алгоритм распределения нагрузки, лежащий в ядре cherry, позволяет узлам как динамически подключаться к кластеру, так и отсоединяться в любой момент.
- Изоляция узлов. Каждый узел взаимодействует непосредственно с сервером, который не предоставляет ему никакой информации о других элементах кластера.
- Обработка событий, связанных с процессом перебора. Например, в случае нахождения секретного ключа одним из узлов сервер уведомляет об этом остальных.

Другие элементы кластера - узлы. Узел является единицей вычислительной мощности кластера и может быть быть одним из двух типов:

- синхронный - выполняет перебор паролей по общему словарю и управляется алгоритмом распределения нагрузки;
- асинхронный - выполняет перебор паролей по собственному набору комбинаций независимо от механизма распределения нагрузки.
Благодаря этому можно совмещать перебор паролей по словарю и, например, перебор определенных буквенно-цифровых комбинаций. В любом случае при обнаружении секретного ключа к handshake узел сообщает об этом серверу.

В составе cherry нет каких-либо алгоритмов атаки на handshake, вместо этого программа позволяет использовать любой доступный в системе инструмент. Благодаря этому в составе кластера могут работать узлы с совершенно разными инструментами перебора, будь то piryt, hashcat, aircrack-ng или любая другая программа. Такая свобода достигается за счет использования драйверов. Драйвер представляет из себя объект, реализующий универсальные методы взаимодействия cherry и конкретного инструмента. Подробнее об этом можно узнать в разделе drivers.md.

### Порядок регистрации узла в кластере
При подключении узла к серверу выполняется четырехстороннее рукопожатие:

- Узел выполняет инициализацию свих параметров и пытается подключиться к слушающему сокету указанного оператором сервера.
- Сервер обрабатывает входящее подключение на основе политики, указанной его оператором, например, максимальное количество подключенных узлов, и либо отклоняет данное подключение, либо принимает, уведомив узел специальным сообщением следующего содержимого:
```javascript
{
	"header"        : "connect",

	"status"        : "connected",
	"version_txt"   : "<версия ПО сервера в текстовом представлении>",
	"version_num"   : "<версия ПО сервера в числовом представлении>",

	// Указывает на необходимость предоставления пароля //
	"secure"        : true/false,
	// Возможность подключения асинхронных узлов //
	"async_allowed" : true/false,
	// Соль для хэширования пароля //
	"salt"          : "<соль>"
}
```
В случае отклонения соединения:
```javascript
{
	"header" : "connect",

	"status" : "rejected",
	"reason" : "<причина отклонения>"
}
```